<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Speak your mind">
  <title>Speak your mind</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="./img/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./img/favicon/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./img/favicon/apple-touch-icon.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
  <link rel="stylesheet" href="css/style.min.css">
</head>

<body>
  <div class="wrapper">
    <header class="header">
      <div class="container">
        <div class="header__logo">
          <div class="header__logo-wrapper">
            <svg width="196" height="24" fill="currentColor">
              <use xlink:href="./img/sprite.svg#logo"></use>
            </svg>
          </div>
        </div>
        <nav class="header__nav nav">
          <div class="nav__wrapper">
            <ul class="nav__list">
              <li class="nav__item nav__item--psychologists">
                <a class="nav__link" data-translate="nav_doc" href="doctor-landing.html">For therapists</a>
              </li>
              <!-- <li class="nav__item nav__item--businnes">
                <a class="nav__link href="businnes-landing.html" data-translate="nav_comp">For companies</a>
              </li> -->
              <li class="nav__item">
                <a class="nav__link" href="faq-clients.html">FAQ</a>
              </li>
            </ul>
          </div>
        </nav>
        <div class="header__lang-switcher lang-switcher">
          <button class="lang-switcher__btn js-dropdown-trigger" data-id="#lang-switcher">
            <span class="current-language"></span>
            <svg width="10" height="10" fill="currentColor">
              <use xlink:href="./img/sprite.svg#dropdown"></use>
            </svg>
          </button>
          <ul class="lang-switcher__list list-reset" id="lang-switcher">
            <!-- <li class="lang-switcher__item">
              <a href="#" data-lang="hu">Hu</a>
            </li> -->
            <li class="lang-switcher__item">
              <a href="#" data-lang="en">En</a>
            </li>
            <li class="lang-switcher__item">
              <a href="#" data-lang="ru">Ru</a>
            </li>
          </ul>
        </div>
        <div class="header__unlogged unlogged">
          <a class="unlogged__login-btn btn btn--white" data-translate="header_login_btn">Login</a>
          <a href="user-signup-start.html" class="unlogged__login-btn btn" data-translate="header_signup_btn">Signup</a>
        </div>
        <div class="header__logged logged">
          <div class="logged__wrapper">
            <div class="logged__user-thumb">
              <img src="./img/content/user-thumb.png" width="24" height="24" alt="">
            </div>
            <button class="logged__btn" id="#logged-menu">
              <span class="logged__username gotten-username">Username</span>
            </button>
            <button type="button" class="header__logout-btn logout-btn">
              <svg width="25" height="25" fill="currentColor">
                <use xlink:href="./img/sprite.svg#nav-logout"></use>
              </svg>
              <span data-translate="logout_btn">Logout</span>
            </button>
          </div>
        </div>
      </div>
    </header>
    <main class="signup-main">
      <div class="signup-header">
        <div class="container">
          <div class="signup-header__links">
            <a class="signup-header__link" data-translate="signup_header_link_main">General
              questions</a>
            <a class="signup-header__link" data-translate="signup_header_link_choice">Choose a therapist</a>
            <a class="signup-header__link is-active" data-translate="signup_header_link_payment">Payment</a>
          </div>
        </div>
      </div>
      <section class="card">
        <div class="container">
          <div class="card__heading">
            <h2 class="title" data-translate="card_title">Link a card to schedule a session</h2>
          </div>
          <div class="card__description">
            <!-- .card__description-wrapper--start по умолчанию имеет класс .is-active.  При ошибке привязки карты, класс удаляется -->
            <div class="card__description-wrapper card__description-wrapper--start is-active">
              <p class="text-18 card__request-sent"><span data-translate="card_subtitle_1">A request to schedule a
                  session for </span><span class="card__session-time"></span><span data-translate="card_subtitle_2">
                  has been sent. Therapist: </span><span class="card__doctor-name">doc_name</span>.</p>
              <p class="text-25" data-translate="card_description_start_1">What happens next?</p>
              <p class="text-18" data-translate="card_description_start_2">The therapist will confirm your request or
                offer an alternative time.</p>
              <p class="text-18" data-translate="card_description_start_3">In the meantime, you need to link a bank card
                to your account. Money is debited from it only when you sign up for a session - exactly 12 hours in
                advance.</p>
              <p class="text-25" data-translate="card_description_start_4">Why is money debited before the service is
                provided?</p>
              <p class="text-18" data-translate="card_description_start_5">Consulting with a psychologist has its own
                laws, including those that regulate monetary relations between the therapist and the client. One of
                these laws states that a session that a client misses with less than 12 hours notice is paid. This is
                done in order to introduce an element of discipline into psychotherapy and avoid the resistance that
                inevitably arises in the client when approaching the hidden corners of his psyche. In this case, he
                begins to skip sessions, coming up with a million reasons for this - and, in the end, no normal work
                happens, but only nonsense. You don't want this, do you? That's what we don't want.</p>
              <p class="text-25" data-translate="card_description_start_6">What should I do if my plans changed after
                money was written off the card?</p>
              <p class="text-18" data-translate="card_description_start_7">Unfortunately, nothing - if you notify about
                rescheduling a session later than 12 hours before it starts, then the money is not refunded.</p>
            </div>
            <!-- .card__description-wrapper--error по умолчанию скрыт. При ошибке привязки карты, добавлется класс .is-active -->
            <div class="card__description-wrapper card__description-wrapper--error">
              <div class="card__error-message">
                <p class="text-18" data-translate="card_description_error_1"><b>An error has occurred.</b></p>
                <p class="text-18" data-translate="card_description_error_2">Failed to link the card. Check the card
                  data and retry or link another card</p>
              </div>
            </div>
          </div>
          <div class="card__card-info">
            <form action="" method="post" id="user-card-form">
              <fieldset>
                <label for="card-owner">
                  <span data-translate="card_owner_name">Card owner name</span>
                  <input type="text" id="card-owner" placeholder="Name on the front of the card"
                    data-translate="card_owner_name_placeholder">
                </label>
              </fieldset>
              <fieldset>
                <label for="card-number">
                  <span data-translate="card_number">Card number</span>
                  <input type="number" id="card-number" placeholder="x x x x    x x x x    x x x x    x x x x">
                </label>
              </fieldset>
              <fieldset>
                <label for="card-exp">
                  <span data-translate="card_exp">Expiration date</span>
                  <input type="number" id="card-exp" placeholder="m m  /  y y">
                </label>
                <label for="card-cvc">
                  <span data-translate="card_cvc">CVС code</span>
                  <input type="number" id="card-cvc" maxlength="3" placeholder="x x x">
                </label>
              </fieldset>
              <p class="card__permission text-18">
                <span data-translate="card_permission_1">By adding a card you accept</span>&nbsp;
                <a href="#" class="text-green" data-open-modal data-modal-id="#payment-terms"
                  data-translate="card_permission_2">the terms of service</a>&nbsp;
                <span data-translate="card_permission_3">and allow</span>&nbsp;
                <a href="#" class="text-green" data-open-modal data-modal-id="#payment-terms"
                  data-translate="card_permission_4">auto-debits</a>
              </p>
              <button type="submit" class="card__submit-btn btn" data-translate="card_submit_btn">Add a card</button>
            </form>
          </div>
        </div>
      </section>
    </main>
    <footer class="footer">
      <div class="container">
        <div class="footer__left"></div>
        <div class="footer__copyright">
          <span>&copy; Speak Your Mind 2023</span>
          <a href="terms.html" class="text-green" data-translate="terms">Terms of Service</a>
        </div>
      </div>
    </footer>
  </div>

  <div class="modal modal--preload" id="payment-terms">
    <div class="modal__wrapper">
      <div class="modal__overlay" data-close-modal></div>
      <div class="modal__content modal__content--new-card">
        <button class="modal__close-btn" type="button" aria-label="Закрыть окно." data-close-modal>
          <svg width="32" height="32" fill="currentColor">
            <use xlink:href="./img/sprite.svg#close-modal"></use>
          </svg>
        </button>
        <h2 class="modal__title text-31" data-translate="payment_terms_title">Terms of service and auto debits</h2>
        <p class="modal__text text-18" data-translate="payment_terms_text_1">The user has access to the function of
          non-cash payment for Video Consultations, in this case, “Speak your mind” acts on behalf of the relevant
          Psychologist with the involvement of an authorized payment system and is the recipient of the payment as an
          agent of the Psychologist (hereinafter referred to as “non-cash payment”)</p>
        <p class="modal__text text-18" data-translate="payment_terms_text_2">"“Speak your mind” does not guarantee the
          absence of errors and failures in the operation of the Service regarding the provision of the possibility of
          non-cash payment. Funds for the Video consultation are written off 24 hours before the Video consultation, and
          if the User signed up for the Video consultation less than 24 hours, then write-off is carried out 12 hours
          before the Video Consultation or at the time of registration for the Video Consultation, whichever comes
          first. If it is impossible to write off funds 12 hours before the Video Consultation, the Video Consultation
          is subject to cancellation."</p>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // получение данных клиента
      const session_token = localStorage.getItem('token');

      function getUserDataFromBackend() {
        if (session_token) {
          fetch('http://www.speakyourmind.help:8000/get_client_data', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${session_token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ session_token: session_token })
          })
            .then(response => {
              if (!response.ok) {
                throw new Error('Сеть не в порядке');
              }
              return response.json();
            })
            .then(data => {
              // TODO удалить вывод в консоль
              console.log('Данные пользователя:', data);
              document.querySelector('.card__doctor-name').textContent = data.has_therapist.doc_name;
              document.querySelector('.card__session-time').textContent = `${new Date(data.has_therapist.sch_time).toLocaleString()}, UTC±0:00`;
            })
            .catch(error => {
              console.error('Ошибка при получении данных пользователя:', error);
            });
        } else {
          console.log('Токен не найден. Пожалуйста, войдите в систему.');
        }
      }

      getUserDataFromBackend();

      document.getElementById('user-card-form').addEventListener('submit', function (e) {
        e.preventDefault();
        // TODO когда будет добавлен блок с привязкой карты -
        const userForm = localStorage.getItem('user_form');
        const hasTherapist = localStorage.getItem('has_therapist');
        if (hasTherapist !== 'selected') {
          window.location.href = '/user-signup-choice.html';
        } else {
          window.location.href = '/user-account-settings.html?from=payment';
        }
      });

    });
  </script>

  <script src="js/vendor.min.js"></script>
  <script src="js/main.min.js"></script>
</body>

</html>
