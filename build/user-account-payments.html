<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Speak your mind">
  <title>Speak your mind</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="./img/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./img/favicon/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./img/favicon/apple-touch-icon.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
  <link rel="stylesheet" href="css/style.min.css">
</head>

<body>
  <div class="wrapper internal">
    <main>
      <section class="user-account">
        <div class="container">
          <div class="user-account__wrapper">
            <div class="user-account__left-col">
              <nav class="user-account__nav">
                <div class="user-account__nav-logo">
                  <a href="user-account-main.html">
                    <img src="./img/svg/nav-logo.svg" width="72" height="72" alt="Speak your mind.">
                  </a>
                </div>
                <a href="user-account-main.html" class="user-account__nav-link">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-main"></use>
                  </svg>
                  <span data-translate="int_nav_main">Main</span>
                </a>
                <a href="user-account-payments.html" class="user-account__nav-link is-active">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-payment"></use>
                  </svg>
                  <span data-translate="int_nav_payments">Payments</span>
                </a>
                <a href="user-account-settings.html" class="user-account__nav-link">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-settings"></use>
                  </svg>
                  <span data-translate="int_nav_profile">Profile</span>
                </a>
                <div href="#" class="user-account__nav-link nav-lang-switcher js-dropdown-trigger"
                  data-id="#nav-lang-switcher">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-language"></use>
                  </svg>
                  <span class="current-language"></span>
                  <svg width="10" height="10" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#dropdown"></use>
                  </svg>
                  </span>
                  <ul class="lang-switcher__list list-reset" id="nav-lang-switcher">
                    <!-- <li class="lang-switcher__item">
                      <a href="#" data-lang="hu">Hu</a>
                    </li> -->
                    <li class="lang-switcher__item">
                      <a href="#" data-lang="en">English</a>
                    </li>
                    <li class="lang-switcher__item">
                      <a href="#" data-lang="ru" data-translate="doc_q_language_ru">Русский</a>
                    </li>
                  </ul>
                </div>
                <a href="user-account-help.html" class="user-account__nav-link">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-help"></use>
                  </svg>
                  <span data-translate="int_nav_help">Help</span>
                </a>
                <a href="index.html" class="user-account__nav-link logout-btn">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-logout"></use>
                  </svg>
                  <span data-translate="int_nav_logout">Logout</span>
                </a>
              </nav>
            </div>
            <div class="user-account__right-col">
              <div class="user-account__payments payments">
                <div class="user-account__heading">
                  <h2 class="user-account__title" data-translate="user_payments_title">Payments</h2>
                </div>
                <div class="payments__card">
                  <p class="payments__card-info">
                    <span data-translate="user_payments_text">Payment is made from a card</span>
                    <span>XXXX XXXX XXXX <span id="card-num">XXXX</span></span>
                  </p>
                </div>
                <button class="payments__btn btn btn--white" data-open-modal data-modal-id="#update-card-popup"
                  data-translate="link_new_card">Link new card</button>
                <div class="payments__heading">
                  <h2 data-translate="payments_history">Payments history</h2>
                </div>
                <div class="payments__history">
                  <!-- <table>
                    <tr>
                      <th>No</th>
                      <th data-translate="th_session">Session</th>
                      <th data-translate="th_sum">Sum</th>
                      <th data-translate="th_hold">Hold</th>
                      <th data-translate="th_write_off">Write-off</th>
                      <th data-translate="th_status">Status</th>
                    </tr>
                    <tr data-transaction="25262740">
                      <td><span class="payments__transaction-number">25262740</span></td>
                      <td><span class="payments__doctor-name text-green"></span><br>Сессия <span
                          class="payments__session-time"><time>06 июля,
                            20:00</time></span></td>
                      <td><span class="payments__sum">10000 HUF</span></td>
                      <td><span class="payments__hold"><time>06 июля,
                            07:59</time></span><br>
                        <span class="payments__hold-status">запланировано</span>
                      </td>
                      <td><span class="payments__processed">-</span></td>
                      <td><span class="payments__status">К оплате</span></td>
                    </tr>
                    <tr data-transaction="25262740">
                      <td><span class="payments__transaction-number">25262740</span></td>
                      <td><span class="payments__doctor-name text-green"></span><br>Сессия <span
                          class="payments__session-time"><time>06 июля,
                            20:00</time></span></td>
                      <td><span class="payments__sum">10000 HUF</span></td>
                      <td><span class="payments__hold"><time>06 июля,
                            07:59</time></span><br>
                        <span class="payments__hold-status">выполнено</span>
                      </td>
                      <td><span class="payments__processed">-</span></td>
                      <td><span class="payments__status">Ожидает списания</span></td>
                    </tr>
                    <tr data-transaction="25262740">
                      <td><span class="payments__transaction-number">25262740</span></td>
                      <td><span class="payments__doctor-name text-green"></span><br>Сессия <span
                          class="payments__session-time"><time>06 июля,
                            20:00</time></span></td>
                      <td><span class="payments__sum">10000 HUF</span></td>
                      <td><span class="payments__hold">-</td>
                      <td><span class="payments__processed"><time>06 июля,
                            07:59</time><br>
                          <span class="payments__processed-status">выполнено</span>
                        </span></td>
                      <td><span class="payments__status">Оплачено</span></td>
                    </tr>
                    <tr data-transaction="25262740" class="error">
                      <td><span class="payments__transaction-number">25262740</span></td>
                      <td><span class="payments__doctor-name text-green"></span><br>Сессия <span
                          class="payments__session-time"><time>06 июля,
                            20:00</time></span></td>
                      <td><span class="payments__sum">10000 HUF</span></td>
                      <td><span class="payments__hold">-</td>
                      <td><span class="payments__processed"><time>06 июля,
                            07:59</time><br>
                          <span class="payments__processed-status">ошибка карты</span>
                        </span></td>
                      <td><span class="payments__status">Не оплачено</span></td>
                    </tr>
                  </table> -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

    </main>
    <footer class="footer">
      <div class="container">
        <div class="footer__left"></div>
        <div class="footer__copyright">
          <span>&copy; Speak Your Mind 2023</span>
          <a href="terms.html" class="text-green" data-translate="terms">Terms of Service</a>
        </div>
      </div>
    </footer>
  </div>

  <div class="modal modal--preload" id="update-card-popup">
    <div class="modal__wrapper">
      <div class="modal__overlay" data-close-modal></div>
      <div class="modal__content modal__content--new-card">
        <button class="modal__close-btn" type="button" aria-label="Закрыть окно." data-close-modal>
          <svg width="32" height="32" fill="currentColor">
            <use xlink:href="./img/sprite.svg#close-modal"></use>
          </svg>
        </button>
        <h2 class="modal__title text-31" data-translate="modal_card_title">Link your card</h2>
        <div class="card">
          <div class="card__card-info">
            <form action="" method="post" id="update-card-form">
              <fieldset>
                <label for="update-card-owner">
                  <span data-translate="card_owner_name">Card owner name</span>
                  <input type="text" id="update-card-owner" placeholder="Name on the front of the card"
                    data-translate="card_owner_name_placeholder">
                </label>
              </fieldset>
              <fieldset>
                <label for="update-card-number">
                  <span data-translate="card_number">Card number</span>
                  <input type="text" id="update-card-number" placeholder="x x x x    x x x x    x x x x    x x x x">
                </label>
              </fieldset>
              <fieldset>
                <label for="update-card-exp">
                  <span data-translate="card_exp">Expiration date</span>
                  <input type="text" id="update-card-exp" placeholder="m m  /  y y">
                </label>
                <label for="update-card-cvc">
                  <span data-translate="card_cvc">CVС code</span>
                  <input type="text" id="update-card-cvc" maxlength="3" placeholder="x x x">
                </label>
              </fieldset>
              <p class="card__permission text-18">
                <span data-translate="card_permission_1">By adding a card you accept</span>&nbsp;
                <a href="#" class="text-green" data-open-modal data-modal-id="#payment-terms"
                  data-translate="card_permission_2">the terms of service</a>&nbsp;
              </p>
              <button type="submit" class="card__submit-btn btn">
                <span class="icon-loader">
                  <svg width="32" height="32" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#icon-loader"></use>
                  </svg>
                </span>
                <span data-translate="card_submit_btn">Add a card</span>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal modal--preload" id="payment-terms">
    <div class="modal__wrapper">
      <div class="modal__overlay" data-close-modal></div>
      <div class="modal__content modal__content--new-card">
        <button class="modal__close-btn" type="button" aria-label="Закрыть окно." data-close-modal>
          <svg width="32" height="32" fill="currentColor">
            <use xlink:href="./img/sprite.svg#close-modal"></use>
          </svg>
        </button>
        <h2 class="modal__title text-31" data-translate="payment_terms_title">Условия сервиса и автосписания</h2>
        <p class="modal__text text-18" data-translate="payment_terms_text_1"> Пользователю доступна функция безналичной
          оплаты Видеоконсультаций, в этом случае «Speak your mind» действует по поручению соответствующего Психолога с
          привлечением уполномоченной платежной системы и является получателем платежа в качестве агента Психолога
          (далее – «безналичная оплата»).
        </p>
        <p class="modal__text text-18" data-translate="payment_terms_text_2">«Speak your mind» не гарантирует отсутствия
          ошибок и сбоев в работе Сервиса в отношении предоставления возможности безналичной оплаты. Списание денежных
          средств за Видеоконсультацию осуществляется за 24 часа до момента проведения Видеоконсультации, а если
          Пользователь записался на Видеоконсультацию менее, чем за 24 часа, то списание осуществляется за 12 часов до
          Видеоконсультации или в момент записи на Видеоконсультацию, в зависимости от того, что наступит ранее. В
          случае невозможности списания денежных средств за 12 часов до проведения Видеоконсультации, Видеоконсультация
          подлежит отмене.</p>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // получение данных клиента
      const session_token = localStorage.getItem('token');

      function getUserDataFromBackend() {
        if (session_token) {
          fetch('https://www.speakyourmind.help:8000/get_client_data', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${session_token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ session_token: session_token })
          })
            .then(response => {
              if (!response.ok) {
                throw new Error('Сеть не в порядке');
              }
              return response.json();
            })
            .then(data => {
              // TODO удалить вывод в консоль
              console.log('Данные пользователя:', data);
              document.querySelector('#card-num').textContent = data.user_card_data ? data.user_card_data : 'XXXX';
            })
            .catch(error => {
              console.error('Ошибка при получении данных пользователя:', error);
            });
        } else {
          console.log('Токен не найден. Пожалуйста, войдите в систему.');
        }
      }

      getUserDataFromBackend();
    });
  </script>

  <script src="js/vendor.min.js"></script>
  <script src="js/main.min.js"></script>
</body>

</html>
