<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Speak your mind">
  <title>Speak your mind</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="./img/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./img/favicon/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./img/favicon/apple-touch-icon.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
  <link rel="stylesheet" href="css/style.min.css">
</head>

<body>
  <div class="wrapper internal user-logged user-logged-doctor">
    <header class="header">
      <div class="container">
        <div class="header__logo">
          <div class="header__logo-wrapper">
            <svg width="196" height="24" fill="currentColor">
              <use xlink:href="./img/sprite.svg#logo"></use>
            </svg>
          </div>
        </div>
        <nav class="header__nav nav">
          <div class="nav__wrapper">
            <ul class="nav__list">
              <li class="nav__item nav__item--psychologists">
                <a class="nav__link" data-translate="nav_doc" href="doctor-landing.html"></a>
              </li>
              <!-- <li class="nav__item nav__item--businnes">
                <a class="nav__link href="businnes-landing.html" data-translate="nav_comp"></a>
              </li> -->
              <li class="nav__item">
                <a class="nav__link" href="faq.html">FAQ</a>
              </li>
            </ul>
          </div>
        </nav>
        <div class="header__lang-switcher lang-switcher">
          <button class="lang-switcher__btn js-dropdown-trigger" data-id="#lang-switcher">
            <span data-translate="current_language"></span>
            <svg width="10" height="10" fill="currentColor">
              <use xlink:href="./img/sprite.svg#dropdown"></use>
            </svg>
          </button>
          <ul class="lang-switcher__list list-reset" id="lang-switcher">
            <!-- <li class="lang-switcher__item">
              <a href="#" data-lang="hu">Hu</a>
            </li> -->
            <li class="lang-switcher__item">
              <a href="#" data-lang="en">En</a>
            </li>
            <li class="lang-switcher__item">
              <a href="#" data-lang="ru">Ru</a>
            </li>
          </ul>
        </div>
        <div class="header__unlogged unlogged">
          <a class="unlogged__login-btn btn btn--white" data-translate="header_login_btn"></a>
          <a href="user-signup-start.html" class="unlogged__login-btn btn" data-translate="header_signup_btn"></a>
        </div>
        <div class="header__logged logged">
          <div class="logged__wrapper">
            <div class="logged__user-thumb">
              <img src="./img/content/user-thumb.png" width="24" height="24" alt="">
            </div>
            <button class="logged__btn js-dropdown-trigger" data-id="#logged-menu">
              <span class="logged__username">Username</span>
              <svg width="10" height="10" fill="currentColor">
                <use xlink:href="./img/sprite.svg#dropdown"></use>
              </svg>
            </button>
            <ul class="logged__menu-list list-reset" id="logged-menu">
              <li class="logged__menu-item">
                <a href="#" data-translate="logout_btn" class="logout-btn">Выйти</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </header>
    <main>
      <section class="doctor-account">
        <div class="container">
          <div class="doctor-account__wrapper">
            <div class="doctor-account__left-col">
              <div class="doctor-account__nav">
                <div class="user-account__nav-logo">
                  <a href="doctor-account-sessions.html">
                    <img src="./img/svg/nav-logo.svg" width="72" height="72" alt="Speak your mind.">
                  </a>
                </div>
                <a href="doctor-account-sessions.html" class="doctor-account__nav-link">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-sessions"></use>
                  </svg>
                  <span data-translate="int_nav_sessions">Сессии</span>
                </a>
                <a href="doctor-account-schedule.html" class="doctor-account__nav-link">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-schedule"></use>
                  </svg>
                  <span data-translate="int_nav_schedule">Расписание</span>
                </a>
                <a href="doctor-account-clients.html" class="doctor-account__nav-link is-active">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-clients"></use>
                  </svg>
                  <span data-translate="int_nav_clients">Клиенты</span>
                </a>
                <a href="doctor-account-payments.html" class="doctor-account__nav-link">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-payment"></use>
                  </svg>
                  <span data-translate="int_nav_payments">Платежи</span>
                </a>
                <a href="doctor-account-settings.html" class="doctor-account__nav-link">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-settings"></use>
                  </svg>
                  <span data-translate="int_nav_profile">Профиль</span>
                </a>
                <a href="/faq.html" class="user-account__nav-link">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-help"></use>
                  </svg>
                  <span data-translate="int_nav_help">Помощь</span>
                </a>
                <a href="doctor-landing.html" class="user-account__nav-link logout-btn">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-logout"></use>
                  </svg>
                  <span data-translate="int_nav_logout">Выход</span>
                </a>
              </div>
            </div>
            <div class="doctor-account__right-col">
              <div class="doctor-account__clients clients">
                <div class="doctor-account__heading">
                  <h2 class="text-40">Клиенты</h2>
                </div>
                <div class="clients__table">
                  <table>
                    <tr>
                      <th>Клиент</th>
                      <th>Имя</th>
                      <th>Возраст</th>
                      <th>Всего сессий</th>
                      <th>Следующая сессия</th>
                      <th>Статус сессии</th>
                    </tr>
                    <tr class="clients__item clients__item--scheduled">
                      <td><span class="clients__client-id">#663385</span></td>
                      <td><span class="clients__client-name" data-open-modal data-modal-id="#client-card">Ксения</span>
                      </td>
                      <td><span class="clients__client-age">36</span></td>
                      <td><span class="clients__sessions-amount">11</span></td>
                      <td><span class="clients__next-session"><time>05 июля, 15:00</time></span></td>
                      <td>
                        <span class="clients__session-status">Запланирована</span>
                        <div class="clients__actions">
                          <button type="button"
                            class="clients__actions-btn clients__actions-btn--confirm">Подтвердить</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--timeoffer"
                            data-open-modal data-modal-id="#doctor-reschedule">Предложить
                            другое время</button>
                          <button type="button"
                            class="clients__actions-btn clients__actions-btn--cancel">Отменить</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--reschedule"
                            data-open-modal data-modal-id="#doctor-reschedule">Перенести</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--schedule"
                            data-open-modal data-modal-id="#doctor-reschedule">Записать</button>
                          <button type="button" class="clients__actions-close">+</button>
                        </div>
                      </td>
                    </tr>
                    <tr class="clients__item clients__item--not-scheduled">
                      <td><span class="clients__client-id">#213715</span></td>
                      <td><span class="clients__client-name" data-open-modal data-modal-id="#client-card">Петр</span>
                      </td>
                      <td><span class="clients__client-age">23</span></td>
                      <td><span class="clients__sessions-amount">48</span></td>
                      <td><span class="clients__next-session"><time>-</time></span></td>
                      <td>
                        <span class="clients__session-status">Не записан</span>
                        <div class="clients__actions">
                          <button type="button"
                            class="clients__actions-btn clients__actions-btn--confirm">Подтвердить</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--timeoffer"
                            data-open-modal data-modal-id="#doctor-reschedule">Предложить
                            другое время</button>
                          <button type="button"
                            class="clients__actions-btn clients__actions-btn--cancel">Отменить</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--reschedule"
                            data-open-modal data-modal-id="#doctor-reschedule">Перенести</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--schedule"
                            data-open-modal data-modal-id="#doctor-reschedule">Записать</button>
                          <button type="button" class="clients__actions-close">+</button>
                        </div>
                      </td>
                    </tr>
                    <tr class="clients__item clients__item--requested">
                      <td><span class="clients__client-id">#784556</span></td>
                      <td><span class="clients__client-name" data-open-modal
                          data-modal-id="#client-card">Афанасий</span></td>
                      <td><span class="clients__client-age">56</span></td>
                      <td><span class="clients__sessions-amount">5</span></td>
                      <td><span class="clients__next-session"><time>06 июля, 12:00</time></span></td>
                      <td>
                        <span class="clients__session-status">Запрос на сессию</span>
                        <div class="clients__actions">
                          <button type="button"
                            class="clients__actions-btn clients__actions-btn--confirm">Подтвердить</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--timeoffer"
                            data-open-modal data-modal-id="#doctor-reschedule">Предложить
                            другое время</button>
                          <button type="button"
                            class="clients__actions-btn clients__actions-btn--cancel">Отменить</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--reschedule"
                            data-open-modal data-modal-id="#doctor-reschedule">Перенести</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--schedule"
                            data-open-modal data-modal-id="#doctor-reschedule">Записать</button>
                          <button type="button" class="clients__actions-close">+</button>
                        </div>
                      </td>
                    </tr>
                    <tr class="clients__item clients__item--scheduled">
                      <td><span class="clients__client-id">#663385</span></td>
                      <td><span class="clients__client-name" data-open-modal data-modal-id="#client-card">Мария</span>
                      </td>
                      <td><span class="clients__client-age">56</span></td>
                      <td><span class="clients__sessions-amount">5</span></td>
                      <td><span class="clients__next-session"><time>09 июля, 16:00</time></span></td>
                      <td>
                        <span class="clients__session-status">Запланирована</span>
                        <div class="clients__actions">
                          <button type="button"
                            class="clients__actions-btn clients__actions-btn--confirm">Подтвердить</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--timeoffer"
                            data-open-modal data-modal-id="#doctor-reschedule">Предложить
                            другое время</button>
                          <button type="button"
                            class="clients__actions-btn clients__actions-btn--cancel">Отменить</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--reschedule"
                            data-open-modal data-modal-id="#doctor-reschedule">Перенести</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--schedule"
                            data-open-modal data-modal-id="#doctor-reschedule">Записать</button>
                          <button type="button" class="clients__actions-close">+</button>
                        </div>
                      </td>
                    </tr>
                    <tr class="clients__item clients__item--unapproved">
                      <td><span class="clients__client-id">#663385</span></td>
                      <td><span class="clients__client-name" data-open-modal
                          data-modal-id="#client-card">Афанасий</span></td>
                      <td><span class="clients__client-age">56</span></td>
                      <td><span class="clients__sessions-amount">5</span></td>
                      <td><span class="clients__next-session"><time>09 июля, 16:00</time></span></td>
                      <td>
                        <span class="clients__session-status">Ожидание<br>подтверждения</span>
                        <div class="clients__actions">
                          <button type="button"
                            class="clients__actions-btn clients__actions-btn--confirm">Подтвердить</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--timeoffer"
                            data-open-modal data-modal-id="#doctor-reschedule">Предложить
                            другое время</button>
                          <button type="button"
                            class="clients__actions-btn clients__actions-btn--cancel">Отменить</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--reschedule"
                            data-open-modal data-modal-id="#doctor-reschedule">Перенести</button>
                          <button type="button" class="clients__actions-btn clients__actions-btn--schedule"
                            data-open-modal data-modal-id="#doctor-reschedule">Записать</button>
                          <button type="button" class="clients__actions-close">+</button>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <footer class="footer">
      <div class="container">
        <div class="footer__left"></div>
        <div class="footer__copyright">
          <span>&copy; Speak Your Mind 2023</span>
          <a href="terms.html" class="text-green">Условия предоставления услуг</a>
        </div>
      </div>
    </footer>
  </div>

  <div class="modal modal--preload" id="upload-avatar">
    <div class="modal__wrapper">
      <div class="modal__overlay" data-close-modal></div>
      <div class="modal__content modal__content--upload-avatar">
        <button class="modal__close-btn" type="button" aria-label="Закрыть окно." data-close-modal>
          <svg width="32" height="32" fill="currentColor">
            <use xlink:href="./img/sprite.svg#close-modal"></use>
          </svg>
        </button>
        <div class="avatar-upload">
          <h2 class="modal__title text-31">Загрузите фото</h2>
          <form action="" method="post" id="avatar-upload-form">
            <fieldset>
              <label>
                <input type="file" name="avatar" id="avatar">
              </label>
            </fieldset>
            <button type="submit" class="avatar-upload__submit-btn btn">Загрузить фото</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal modal--preload" id="new-card-popup">
    <div class="modal__wrapper">
      <div class="modal__overlay" data-close-modal></div>
      <div class="modal__content modal__content--new-card">
        <button class="modal__close-btn" type="button" aria-label="Закрыть окно." data-close-modal>
          <svg width="32" height="32" fill="currentColor">
            <use xlink:href="./img/sprite.svg#close-modal"></use>
          </svg>
        </button>
        <h2 class="modal__title text-31">Привязать карту</h2>
        <div class="card">
          <div class="card__card-info">
            <form action="" method="post">
              <fieldset>
                <label for="card-owner">
                  <span>Имя владельца карты</span>
                  <input type="text" id="card-owner" placeholder="Имя на лицевой стороне карты">
                </label>
              </fieldset>
              <fieldset>
                <label for="card-number">
                  <span>Номер карты</span>
                  <input type="number" id="card-number" placeholder="x x x x    x x x x    x x x x    x x x x">
                </label>
              </fieldset>
              <fieldset>
                <label for="card-exp">
                  <span data-translate="card_exp">Срок действия</span>
                  <input type="number" id="card-exp" placeholder="m m  /  y y">
                </label>
                <label for="card-cvc">
                  <span>Код CVС</span>
                  <input type="number" id="card-cvc" maxlength="3" placeholder="x x x">
                </label>
              </fieldset>
              <p class="card__permission text-18">
                Добавляя карту вы принимаете <a href="#" data-open-modal data-modal-id="#payment-terms"
                  class="text-green">условия сервиса</a>
              </p>
              <button type="submit" class="card__submit-btn btn">Добавить карту</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal modal--preload" id="payment-terms">
    <div class="modal__wrapper">
      <div class="modal__overlay" data-close-modal></div>
      <div class="modal__content modal__content--new-card">
        <button class="modal__close-btn" type="button" aria-label="Закрыть окно." data-close-modal>
          <svg width="32" height="32" fill="currentColor">
            <use xlink:href="./img/sprite.svg#close-modal"></use>
          </svg>
        </button>
        <h2 class="modal__title text-31">Условия сервиса и автосписания</h2>
        <p class="modal__text text-18"> Пользователю доступна функция безналичной оплаты Видеоконсультаций, в этом
          случае «Speak your mind» действует по поручению соответствующего Психолога с привлечением уполномоченной
          платежной системы и является получателем платежа в качестве агента Психолога (далее – «безналичная оплата»).
        </p>
        <p class="modal__text text-18">«Speak your mind» не гарантирует отсутствия ошибок и сбоев в работе Сервиса в
          отношении предоставления
          возможности безналичной оплаты. Списание денежных средств за Видеоконсультацию осуществляется за 24 часа до
          момента проведения Видеоконсультации, а если Пользователь записался на Видеоконсультацию менее, чем за 24
          часа, то списание осуществляется за 12 часов до Видеоконсультации или в момент записи на Видеоконсультацию, в
          зависимости от того, что наступит ранее. В случае невозможности списания денежных средств за 12 часов до
          проведения Видеоконсультации, Видеоконсультация подлежит отмене.</p>
      </div>
    </div>
  </div>

  <div class="modal modal--preload" id="client-card">
    <div class="modal__wrapper">
      <div class="modal__overlay" data-close-modal></div>
      <div class="modal__content modal__content--client-card client-card">
        <button class="modal__close-btn" type="button" aria-label="Закрыть окно." data-close-modal>
          <svg width="32" height="32" fill="currentColor">
            <use xlink:href="./img/sprite.svg#close-modal"></use>
          </svg>
        </button>
        <p class="client-card__heading">
          <span class="text-31 client-card__username">Ксения</span>
          <span class="text-31 client-card__userid">#663385</span>
        </p>
        <p class="client-card__info">
          <span class="text-20 client-card__info-subhead">Возраст</span>
          <span><span class="text-20 client-card__age">36</span> лет</span>
        </p>
        <p class="client-card__info">
          <span class="text-20 client-card__info-subhead">Сессий</span>
          <span class="text-20 client-card__sessions-amount">11</span>
        </p>
        <p class="client-card__info">
          <span class="text-20 client-card__info-subhead">Следующая сессия</span>
          <span class="text-20 client-card__next-session">05 июля 15:00</span>
        </p>
        <p class="client-card__info">
          <span class="text-20 client-card__info-subhead">Запрос</span>
          <span class="text-20 client-card__next-session">Депрессивные состояния, одиночество, отношения с родителями,
            “не знаю, чем хочу заниматься”</span>
        </p>
        <div class="client-card__btns-wrapper">
          <a href="#" class="client-card__btn client-card__btn--chat btn btn--white">
            <svg width="30" height="22" fill="currentColor">
              <use xlink:href="./img/sprite.svg#chat"></use>
            </svg>
            <span>Чат с клиентом</span>
          </a>
          <a href="#" class="client-card__btn client-card__btn--notes btn btn--white">Заметки</a>
        </div>
      </div>
    </div>
  </div>

  <div class="modal modal--preload" id="doctor-reschedule">
    <div class="modal__wrapper">
      <div class="modal__overlay" data-close-modal></div>
      <div class="modal__content modal__content--doctor-reschedule doctor-reschedule">
        <button class="modal__close-btn" type="button" aria-label="Закрыть окно." data-close-modal>
          <svg width="32" height="32" fill="currentColor">
            <use xlink:href="./img/sprite.svg#close-modal"></use>
          </svg>
        </button>
        <h2 class="text-25 doctor__title">Мое расписание</h2>
        <form action="" method="post">
          <div class="schedule-container" id="schedule-container-2"></div>
          <button type="button" class="doctor__expand-btn schedule__show-more" data-id="#schedule-container-2">
            <span data-translate="schedule_show_more">Показать еще 3 дня</span>
            <svg width="10" height="10" fill="currentColor">
              <use xlink:href="./img/sprite.svg#dropdown-green"></use>
            </svg>
          </button>
          <button type="submit" class="doctor__submit-btn btn">
            <span class="doctor__submit-text">Выбрать&nbsp;</span>
          </button>
        </form>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {

      // Получение токена из Local Storage
      const token = localStorage.getItem('token');

      // получение расписания с бэкенда

      function loadDataFromBackend() {

        const dataToSend = JSON.stringify({
          session_token: token,
          schedule: [],
          timezone: ''
        });

        // Отправка запроса на сервер для получения расписания
        fetch('http://www.speakyourmind.help:8000/doctor_schedule', {
          // mode: 'no-cors',
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: dataToSend
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Сеть не в порядке');
            }
            return response.json();
          })
          .then(data => {
            // Обновляем dataObject и localStorage на основе полученных данных
            if (data.schedule) {
              updateDocSchedule(data);
            }
          })
          .catch(error => {
            console.error('Ошибка при получении данных:', error);
          });
      }


      if (token) {
        // Отправка запроса на сервер для получения данных пользования
        fetch('http://www.speakyourmind.help:8000/get_doc_data', {
          // mode: 'no-cors',
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ session_token: token })
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Сеть не в порядке');
            }
            return response.json();
          })
          .then(data => {
            // TODO удалить вывод в консоль
            console.log('Данные пользователя:', data);
            loadDataFromBackend();
          })
          .catch(error => {
            console.error('Ошибка при получении данных пользователя:', error);
          });
      } else {
        console.log('Токен не найден. Пожалуйста, войдите в систему.');
      }

      function updateDocSchedule(data) {
        console.log('Расписание:', data);
        const jsonData = data;

        // Функция для форматирования даты
        function formatDate(dateString) {
          const options = { day: 'numeric', month: 'long', weekday: 'long' };
          const date = new Date(dateString);
          return date.toLocaleDateString('ru-RU', options);
        }

        // Группировка расписания по датам
        const scheduleByDate = {};

        jsonData.schedule.forEach(dateTime => {
          const [date, time] = dateTime.split(' ');
          if (!scheduleByDate[date]) {
            scheduleByDate[date] = [];
          }
          scheduleByDate[date].push(time);
        });

        // Генерация HTML-разметки
        let html = '';

        for (const date in scheduleByDate) {
          const formattedDate = formatDate(date.split('-').reverse().join('-')); // Преобразуем формат даты
          const dayOfWeek = new Date(date.split('-').reverse().join('-')).toLocaleString('ru-RU', { weekday: 'long' });

          html += `
        <div class="doctor__day-wrapper">
            <p class="doctor__day">
                <time datetime="${date.split('-').reverse().join('-')}">${formattedDate}</time>
            </p>
            <fieldset>
    `;

          scheduleByDate[date].forEach(time => {
            html += `
                <label>
                    <input type="radio" name="appointment-time" value="${time}">
                    <span class="time-value">${time}</span>
                </label>
        `;
          });

          html += `
            </fieldset>
        </div>
    `;
        }

        // Вставка HTML в нужное место на странице
        // document.getElementById('schedule-container').innerHTML = html;
        document.querySelectorAll('.schedule-container').forEach((el) => {
          el.innerHTML = html;
        })
      }

    });
  </script>

  <script src="js/vendor.min.js"></script>
  <script src="js/main.min.js"></script>
</body>

</html>
