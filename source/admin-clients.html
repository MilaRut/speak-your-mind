<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Speak your mind">
  <title>Speak your mind</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="./img/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./img/favicon/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./img/favicon/apple-touch-icon.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
  <link rel="stylesheet" href="css/style.min.css">
</head>

<body class="admin">
  <div class="wrapper user-logged internal admin">
    <main>
      <section class="admin__content admin-content">
        <div class="container">
          <div class="admin-content__wrapper">
            <div class="admin-content__left-col">
              <nav class="admin-content__nav">
                <div class="admin-content__nav-logo">
                  <img src="./img/svg/nav-logo.svg" width="72" height="72" alt="Speak your mind.">
                </div>
                <a href="admin-main.html" class="admin-content__nav-link">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-home"></use>
                  </svg>
                  <span data-translate="int_nav_main">Главная</span>
                </a>
                <a href="admin-clients.html" class="admin-content__nav-link is-active">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-clients"></use>
                  </svg>
                  <span data-translate="int_nav_clients">Клиенты</span>
                </a>
                <a href="admin-doctors.html" class="admin-content__nav-link">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M9 20C9 20.2652 9.10536 20.5196 9.29289 20.7071C9.48043 20.8946 9.73478 21 10 21H14C14.2652 21 14.5196 20.8946 14.7071 20.7071C14.8946 20.5196 15 20.2652 15 20V15H20C20.2652 15 20.5196 14.8946 20.7071 14.7071C20.8946 14.5196 21 14.2652 21 14V10C21 9.73478 20.8946 9.48043 20.7071 9.29289C20.5196 9.10536 20.2652 9 20 9H15V4C15 3.73478 14.8946 3.48043 14.7071 3.29289C14.5196 3.10536 14.2652 3 14 3H10C9.73478 3 9.48043 3.10536 9.29289 3.29289C9.10536 3.48043 9 3.73478 9 4V9H4C3.73478 9 3.48043 9.10536 3.29289 9.29289C3.10536 9.48043 3 9.73478 3 10V14C3 14.2652 3.10536 14.5196 3.29289 14.7071C3.48043 14.8946 3.73478 15 4 15H9V20Z"
                      stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                  <span data-translate="int_nav_doctors">Терапевты</span>
                </a>
                <a href="404.html" class="admin-content__nav-link">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M3 11V15.8C3 16.92 3 17.48 3.218 17.908C3.40974 18.2843 3.71569 18.5903 4.092 18.782C4.519 19 5.079 19 6.197 19H17.803C18.921 19 19.48 19 19.907 18.782C20.284 18.59 20.59 18.284 20.782 17.908C21 17.48 21 16.922 21 15.804V11M3 11V9M3 11H21M21 11V9M3 9V8.2C3 7.08 3 6.52 3.218 6.092C3.41 5.715 3.715 5.41 4.092 5.218C4.52 5 5.08 5 6.2 5H17.8C18.92 5 19.48 5 19.907 5.218C20.284 5.41 20.59 5.715 20.782 6.092C21 6.519 21 7.079 21 8.197V9M3 9H21M7 15H11"
                      stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                  <span data-translate="int_nav_finances">Финансы</span>
                </a>
                <a href="404.html" class="admin-content__nav-link">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M9 6H9.337C9.581 6 9.704 6 9.819 6.028C9.921 6.052 10.019 6.093 10.109 6.148C10.209 6.209 10.296 6.296 10.469 6.468L13.532 9.531C13.704 9.704 13.79 9.791 13.852 9.891C13.907 9.981 13.948 10.079 13.972 10.181C14 10.295 14 10.416 14 10.655V18M9 6H4.6C4.04 6 3.76 6 3.546 6.109C3.35785 6.20487 3.20487 6.35785 3.109 6.546C3 6.76 3 7.04 3 7.6V19.4C3 19.96 3 20.24 3.109 20.454C3.20487 20.6422 3.35785 20.7951 3.546 20.891C3.76 21 4.039 21 4.598 21H12.401C12.96 21 13.241 21 13.454 20.891C13.6422 20.7952 13.7952 20.6422 13.891 20.454C14 20.24 14 19.96 14 19.4V18M9 6V9.4C9 9.96 9 10.24 9.109 10.454C9.20487 10.6422 9.35785 10.7951 9.546 10.891C9.76 11 10.039 11 10.598 11H14M14 18H19.402C19.96 18 20.24 18 20.455 17.891C20.6425 17.7949 20.7948 17.6419 20.89 17.454C21 17.24 21 16.96 21 16.4V7.655C21 7.416 21 7.295 20.972 7.181C20.948 7.079 20.907 6.981 20.852 6.891C20.79 6.791 20.704 6.704 20.532 6.531L17.469 3.468C17.296 3.296 17.209 3.209 17.109 3.148C17.019 3.093 16.921 3.052 16.819 3.028C16.704 3 16.581 3 16.337 3H16M10 6V4.6C10 4.04 10 3.76 10.109 3.546C10.2049 3.35785 10.3578 3.20487 10.546 3.109C10.76 3 11.04 3 11.6 3H16M16 3V6.4C16 6.96 16 7.24 16.109 7.454C16.2049 7.64215 16.3578 7.79513 16.546 7.891C16.76 8 17.039 8 17.598 8H21"
                      stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                  <span data-translate="int_nav_pages">Страницы</span>
                </a>
                <a href="404.html" class="admin-content__nav-link">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M4 6L10.108 10.612L10.11 10.614C10.788 11.111 11.127 11.36 11.499 11.456C11.8276 11.541 12.1724 11.541 12.501 11.456C12.873 11.36 13.213 11.111 13.893 10.612C13.893 10.612 17.81 7.606 20 6M3 15.8V8.2C3 7.08 3 6.52 3.218 6.092C3.41 5.715 3.715 5.41 4.092 5.218C4.52 5 5.08 5 6.2 5H17.8C18.92 5 19.48 5 19.907 5.218C20.284 5.41 20.59 5.715 20.782 6.092C21 6.519 21 7.079 21 8.197V15.804C21 16.922 21 17.48 20.782 17.908C20.5899 18.2844 20.2836 18.5903 19.907 18.782C19.48 19 18.921 19 17.803 19H6.197C5.079 19 4.519 19 4.092 18.782C3.71569 18.5903 3.40974 18.2843 3.218 17.908C3 17.48 3 16.92 3 15.8Z"
                      stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                  <span data-translate="int_nav_mailings">Рассылки</span>
                </a>
                <a href="404.html" class="admin-content__nav-link">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M10 18H21M3 18H6M6 18V20M6 18V16M20 12H21M3 12H16M16 12V14M16 12V10M14 6H21M3 6H10M10 6V8M10 6V4"
                      stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                  <span data-translate="int_nav_settings">Настройки</span>
                </a>
                <div href="#" class="admin-content__nav-link nav-lang-switcher js-dropdown-trigger"
                  data-id="#nav-lang-switcher">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-language"></use>
                  </svg>
                  <span class="current-language"></span>
                  <svg width="10" height="10" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#dropdown"></use>
                  </svg>
                  </span>
                  <ul class="lang-switcher__list list-reset" id="nav-lang-switcher">
                    <!-- <li class="lang-switcher__item">
                      <a href="#" data-lang="hu">Hu</a>
                    </li> -->
                    <li class="lang-switcher__item">
                      <a href="#" data-lang="en">English</a>
                    </li>
                    <li class="lang-switcher__item">
                      <a href="#" data-lang="ru" data-translate="doc_q_language_ru">Русский</a>
                    </li>
                  </ul>
                </div>
                <a href="404.html" class="admin-content__nav-link">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M9 11V20M9 11H4.6C4.04 11 3.76 11 3.546 11.109C3.35785 11.2049 3.20487 11.3578 3.109 11.546C3 11.76 3 12.04 3 12.6V20H9M9 11V5.6C9 5.04 9 4.76 9.109 4.546C9.20487 4.35785 9.35785 4.20487 9.546 4.109C9.76 4 10.04 4 10.6 4H13.4C13.96 4 14.24 4 14.454 4.109C14.642 4.205 14.794 4.358 14.891 4.546C15 4.76 15 5.04 15 5.6V8M9 20H15M15 8H19.4C19.96 8 20.24 8 20.455 8.109C20.6425 8.20504 20.7948 8.35803 20.89 8.546C21 8.76 21 9.04 21 9.6V20H15M15 8V20"
                      stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                  <span data-translate="int_nav_statistics">Статистика</span>
                </a>
                <a href="#" class="admin-content__nav-link logout-btn">
                  <svg width="25" height="25" fill="currentColor">
                    <use xlink:href="./img/sprite.svg#nav-logout"></use>
                  </svg>
                  <span data-translate="int_nav_logout">Выход</span>
                </a>
              </nav>
            </div>
            <div class="admin-content__right-col">
              <div class="admin-content__main">
                <div class="admin-content__heading">
                  <h1 data-translate="int_nav_clients">Клиенты</h1>
                </div>
                <div class="admin-table">
                  <table>
                    <tbody>
                      <tr class="admin-table__head">
                        <th>ID</th>
                        <th data-translate="admin_table_name">Имя</th>
                        <th>Email</th>
                        <th data-translate="admin_table_sum">Всего оплачено</th>
                        <th data-translate="admin_table_reg_date">Дата регистрации</th>
                        <th data-translate="admin_table_last_session">Последняя сессия</th>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <footer class="footer">
      <div class="container">
        <div class="footer__left"></div>
        <div class="footer__copyright">
          <span>&copy; Speak Your Mind 2023</span>
          <a href="terms.html" class="text-green" data-translate="terms">Условия предоставления услуг</a>
        </div>
      </div>
    </footer>
  </div>

  <div class="modal modal--preload" id="session-warning">
    <div class="modal__wrapper">
      <div class="modal__overlay" data-close-modal></div>
      <div class="modal__content">
        <button class="modal__close-btn" type="button" aria-label="Закрыть окно." data-close-modal>
          <svg width="32" height="32" fill="currentColor">
            <use xlink:href="./img/sprite.svg#close-modal"></use>
          </svg>
        </button>
        <p style="padding: 40px;">Внимание: при неактивности на странице в течение 15 минут, сессия будет завершена в
          целях безопасности</p>
        <button type="button" class="btn btn--white" aria-label="Закрыть окно." data-close-modal
          style="padding: 16px 24px; display: block; margin: 0 auto;">
          Понятно
        </button>
      </div>
    </div>
  </div>

  <div class="modal modal--preload" id="logout-warning">
    <div class="modal__wrapper">
      <div class="modal__overlay" data-close-modal></div>
      <div class="modal__content">
        <button class="modal__close-btn" type="button" aria-label="Закрыть окно." data-close-modal>
          <svg width="32" height="32" fill="currentColor">
            <use xlink:href="./img/sprite.svg#close-modal"></use>
          </svg>
        </button>
        <p style="padding: 40px;">Внимание, через 1 минуту сессия будет завершена. Чтобы продлить сессию, совершите любое действие (например, подвигайте мышью).</p>
        <button type="button" class="btn btn--white" aria-label="Закрыть окно." data-close-modal
          style="padding: 16px 24px; display: block; margin: 0 auto;">
          Понятно
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {

      const token = localStorage.getItem('token');

      // функция для форматирования даты
      function formatDate(dateString) {
        const dateObj = new Date(dateString);
        const language = localStorage.getItem('language') || 'en';

        const options = {
          day: 'numeric',
          month: 'short',
          year: 'numeric'
        };

        const formattedDate = dateObj.toLocaleDateString(language === 'en' ? 'en-US' : 'ru-RU', options);
        return language === 'ru' ? formattedDate.replace('г.', '').trim() : formattedDate;
      }

      // получение списка клиентов с бэкенда
      async function fetchData() {
        if (token) {
          try {
            const response = await fetch('http://127.0.0.1:8000/list_clients', {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ session_token: token })
            });

            if (!response.ok) {
              throw new Error('Сеть не в порядке');
            }

            const clientsData = await response.json();

            const clientsList = clientsData.list;
            console.log('Список клиентов:', clientsList);
            const tableBody = document.querySelector('.admin-table tbody');

            for (const client of clientsList) {
              const row = document.createElement('tr');
              row.className = 'admin-table__item';
              row.innerHTML = `
                      <tr class="admin-table__item">
                      <td><span class="admin-table__id">${client.client_id}</span></td>
                      <td><span class="admin-table__name">${client.name}</span></td>
                      <td><span class="admin-table__email">${client.email}</span></td>
                      <td><span class="admin-table__amount">0</span></td>
                      <td><span class="admin-table__regdate"><time>${formatDate(client.registred_date)}</time></span></td>
                      <td><span class="admin-table__last"><time>-</time></span></td>
                      <td class="admin-table__popup">
                        <div class="admin-table__popup-wrapper">
                          <a class="admin-table__popup-btn admin-table__popup-btn--edit text-green"
                            data-translate="edit"
                            href="admin-client-profile.html?id=${client.client_id}&email=${encodeURIComponent(client.email)}">
                            Редактировать</a>
                          <button class="admin-table__popup-btn admin-table__popup-btn--message text-green"
                            data-translate="admin_send_message">Написать сообщение</button>
                        </div>
                      </td>
                    </tr>
                    `;
              tableBody.appendChild(row);
              row.addEventListener('click', (e) => {
                document.querySelectorAll('.admin-table tr').forEach((el) => {
                  el.classList.remove('is-active');
                });
                row.classList.add('is-active');
                e.stopPropagation();
              });
              document.addEventListener('click', () => {
                document.querySelectorAll('.admin-table tr').forEach((el) => {
                  el.classList.remove('is-active');
                });
              });
            }
          } catch (error) {
            console.error('Ошибка при получении данных:', error);
          }
        } else {
          console.log('Токен не найден. Пожалуйста, войдите в систему.');
        }
      }

      fetchData();
    });
  </script>

  <script src="js/vendor.min.js"></script>
  <script src="js/main.min.js"></script>
</body>

</html>
