<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Speak your mind">
  <title>Speak your mind</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="./img/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./img/favicon/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./img/favicon/apple-touch-icon.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
  <link rel="stylesheet" href="css/style.min.css">
</head>

<body>
  <div class="wrapper">
    <header class="header">
      <div class="container">
        <div class="header__logo">
          <div class="header__logo-wrapper">
            <svg width="196" height="24" fill="currentColor">
              <use xlink:href="./img/sprite.svg#logo"></use>
            </svg>
          </div>
        </div>
        <nav class="header__nav nav">
          <div class="nav__wrapper">
            <ul class="nav__list">
              <li class="nav__item nav__item--psychologists">
                <a class="nav__link" data-translate="nav_doc" href="doctor-landing.html">For therapists</a>
              </li>
              <!-- <li class="nav__item nav__item--businnes">
                <a class="nav__link href="businnes-landing.html" data-translate="nav_comp">For companies</a>
              </li> -->
              <li class="nav__item">
                <a class="nav__link" href="faq.html">FAQ</a>
              </li>
            </ul>
          </div>
        </nav>
        <div class="header__lang-switcher lang-switcher">
          <button class="lang-switcher__btn js-dropdown-trigger" data-id="#lang-switcher">
            <span class="current-language"></span>
            <svg width="10" height="10" fill="currentColor">
              <use xlink:href="./img/sprite.svg#dropdown"></use>
            </svg>
          </button>
          <ul class="lang-switcher__list list-reset" id="lang-switcher">
            <!-- <li class="lang-switcher__item">
              <a href="#" data-lang="hu">Hu</a>
            </li> -->
            <li class="lang-switcher__item">
              <a href="#" data-lang="en">En</a>
            </li>
            <li class="lang-switcher__item">
              <a href="#" data-lang="ru">Ru</a>
            </li>
          </ul>
        </div>
        <div class="header__unlogged unlogged">
          <a class="unlogged__login-btn btn btn--white" data-translate="header_login_btn">Login</a>
          <a href="user-signup-start.html" class="unlogged__login-btn btn" data-translate="header_signup_btn">Signup</a>
        </div>
        <div class="header__logged logged">
          <div class="logged__wrapper">
            <div class="logged__user-thumb">
              <img src="./img/content/user-thumb.png" width="24" height="24" alt="">
            </div>
            <button class="logged__btn" id="#logged-menu">
              <span class="logged__username gotten-username">Username</span>
            </button>
          </div>
        </div>
      </div>
    </header>
    <main class="signup-main">
      <section class="questions">
        <div class="container">
          <div class="questions__wrapper">
            <div class="questions__heading">
              <h1 class="subtitle"><span data-translate="signup_main_welcome_title">Welcome </span><span
                  class="gotten-username">Username</span>!</h1>
              <p class="text-18" data-translate="signup_main_subtitle">Please answer the questions so that we can offer
                you a suitable specialist.</p>
            </div>
            <div class="signup-header">
              <div class="signup-header__links">
                <a class="signup-header__link is-active" data-translate="signup_header_link_main">General
                  questions</a>
                <a class="signup-header__link" data-translate="signup_header_link_choice">Choose a therapist</a>
                <a class="signup-header__link" data-translate="signup_header_link_payment">Payment</a>
              </div>
            </div>
            <form action="" method="post" id="user-signup-main-form">
              <fieldset class="questions__main">
                <div class="questions__main-row questions__main-row--age">
                  <span class="text-20" data-translate="date_of_birth">Your date of birth</span>
                  <div class="inputs-wrapper">
                    <input type="date" name="age" id="age">
                    <label for="age"></label>
                  </div>
                </div>
                <div class="questions__radio questions__main-row questions__main-row--experience">
                  <span class="text-20" data-translate="therapy_experience">Have you had therapy experience?</span>
                  <div class="inputs-wrapper">
                    <input type="radio" id="experience-yes" name="experience" value="0" checked>
                    <label for="experience-yes">
                      <svg width="18" height="18" fill="currentColor">
                        <use xlink:href="./img/sprite.svg#check-mark"></use>
                      </svg>
                      <span class="text-14" data-translate="yes">Yes</span>
                    </label>
                    <input type="radio" id="experience-no" name="experience" value="1">
                    <label for="experience-no">
                      <svg width="18" height="18" fill="currentColor">
                        <use xlink:href="./img/sprite.svg#check-mark"></use>
                      </svg>
                      <span class="text-14" data-translate="no">No</span>
                    </label>
                  </div>
                </div>
                <div class="questions__radio questions__main-row questions__main-row--therapy-type">
                  <span class="text-20" data-translate="therapy_type">hat type of therapy are you interested in?</span>
                  <div class="inputs-wrapper">
                    <input type="radio" id="type-individual" name="type" value="0" checked>
                    <label for="type-individual">
                      <svg width="18" height="18" fill="currentColor">
                        <use xlink:href="./img/sprite.svg#check-mark"></use>
                      </svg>
                      <span class="text-14" data-translate="therapy_type_individual">Individual</span>
                    </label>
                    <input type="radio" id="type-couples" name="type" value="1">
                    <label for="type-couples">
                      <svg width="18" height="18" fill="currentColor">
                        <use xlink:href="./img/sprite.svg#check-mark"></use>
                      </svg>
                      <span class="text-14" data-translate="therapy_type_couples">Couples</span>
                    </label>
                  </div>
                </div>
              </fieldset>
              <div class="questions__legend">
                <p class="text-31" data-translate="questions_legend_1">What would you like to discuss first?</p>
                <p class="text-18" data-translate="questions_legend_2">You can skip this question if you are not sure
                  what exactly is bothering you.</p>
              </div>
              <div class="questions__checkboxes questions__checkboxes--1">
                <p class="text-20" data-translate="symptoms_title_1">Relationship with yourself</p>
                <fieldset>
                  <div class="inputs-wrapper">
                    <label>
                      <input type="checkbox" id="symptoms_0" name="symptoms" value="0">
                      <span data-translate="symptoms_0">Fatigue</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_1" name="symptoms" value="1">
                      <span data-translate="symptoms_1">Depressive conditions</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_2" name="symptoms" value="2">
                      <span data-translate="symptoms_2">Irritability</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_3" name="symptoms" value="3">
                      <span data-translate="symptoms_3">Anxiety</span>
                    </label>
                  </div>
                  <div class="inputs-wrapper">
                    <label>
                      <input type="checkbox" id="symptoms_4" name="symptoms" value="4">
                      <span data-translate="symptoms_4">Panic attacks</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_5" name="symptoms" value="5">
                      <span data-translate="symptoms_5">Self-Esteem</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_6" name="symptoms" value="6">
                      <span data-translate="symptoms_6">Loneliness</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_7" name="symptoms" value="7">
                      <span data-translate="symptoms_7">Behavioral addiction</span>
                    </label>
                  </div>
                  <div class="inputs-wrapper">
                    <label>
                      <input type="checkbox" id="symptoms_8" name="symptoms" value="8">
                      <span data-translate="symptoms_8">Chemical dependencies</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_9" name="symptoms" value="9">
                      <span data-translate="symptoms_9">Critical states</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_10" name="symptoms" value="10">
                      <span data-translate="symptoms_10">LGBT+</span>
                    </label>
                  </div>
                </fieldset>
              </div>
              <div class="questions__checkboxes questions__checkboxes--2">
                <p class="text-20" data-translate="symptoms_title_2">Relationships with others</p>
                <fieldset>
                  <div class="inputs-wrapper">
                    <label>
                      <input type="checkbox" id="symptoms_11" name="symptoms" value="11">
                      <span data-translate="symptoms_11">With a partner</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_12" name="symptoms" value="12">
                      <span data-translate="symptoms_12">With parents</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_13" name="symptoms" value="13">
                      <span data-translate="symptoms_13">Sexual</span>
                    </label>
                  </div>
                  <div class="inputs-wrapper">
                    <label>
                      <input type="checkbox" id="symptoms_14" name="symptoms" value="14">
                      <span data-translate="symptoms_14">In general, with others</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_15" name="symptoms" value="15">
                      <span data-translate="symptoms_15">With children</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_16" name="symptoms" value="16">
                      <span data-translate="symptoms_16">Difficulty with orientation, finding it</span>
                    </label>
                  </div>
                </fieldset>
              </div>
              <div class="questions__checkboxes questions__checkboxes--3">
                <p class="text-20" data-translate="symptoms_title_3">Work, study</p>
                <fieldset>
                  <div class="inputs-wrapper">
                    <label>
                      <input type="checkbox" id="symptoms_17" name="symptoms" value="17">
                      <span data-translate="symptoms_17">Lack of motivation</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_18" name="symptoms" value="18">
                      <span data-translate="symptoms_18">“I don't know what I want to do”</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_19" name="symptoms" value="19">
                      <span data-translate="symptoms_19">Lack of purpose</span>
                    </label>
                  </div>
                  <div class="inputs-wrapper">
                    <label>
                      <input type="checkbox" id="symptoms_20" name="symptoms" value="20">
                      <span data-translate="symptoms_20">Burnout</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_21" name="symptoms" value="21">
                      <span data-translate="symptoms_21">Procrastination</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_22" name="symptoms" value="22">
                      <span data-translate="symptoms_22">Shift, job loss</span>
                    </label>
                  </div>
                </fieldset>
              </div>
              <div class="questions__checkboxes questions__checkboxes--4">
                <p class="text-20" data-translate="symptoms_title_4">Events in Your Life</p>
                <fieldset>
                  <div class="inputs-wrapper">
                    <label>
                      <input type="checkbox" id="symptoms_23" name="symptoms" value="23">
                      <span data-translate="symptoms_23">Moving, emigration</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_24" name="symptoms" value="24">
                      <span data-translate="symptoms_24">Breakup, divorce</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_25" name="symptoms" value="25">
                      <span data-translate="symptoms_25">Loss of a loved one</span>
                    </label>
                  </div>
                  <div class="inputs-wrapper">
                    <label>
                      <input type="checkbox" id="symptoms_26" name="symptoms" value="26">
                      <span data-translate="symptoms_26">Pregnancy, childbirth</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_27" name="symptoms" value="27">
                      <span data-translate="symptoms_27">Financial changes</span>
                    </label>
                    <label>
                      <input type="checkbox" id="symptoms_28" name="symptoms" value="28">
                      <span data-translate="symptoms_28">Disease, your own or loved ones</span>
                    </label>
                  </div>
                </fieldset>
              </div>
              <hr>
              <div class="questions__radio questions__therapist-gender">
                <p class="text-20" data-translate="therapist_gender">Who would you be more comfortable working with?</p>
                <div class="inputs-wrapper">
                  <input type="radio" id="gender-female" name="therapist-gender" value="1" checked>
                  <label for="gender-female">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14" data-translate="therapist_gender_female">With a woman</span>
                  </label>
                  <div class="divider"></div>
                  <input type="radio" id="gender-male" name="therapist-gender" value="0">
                  <label for="gender-male">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14" data-translate="therapist_gender_male">With a man</span>
                  </label>
                  <div class="divider"></div>
                  <input type="radio" id="gender-any" name="therapist-gender" value="2">
                  <label for="gender-any">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14" data-translate="therapist_gender_any">Don't care</span>
                  </label>
                </div>
              </div>
              <hr>
              <div class="questions__radio questions__language">
                <p class="text-20" data-translate="preferred_language">What language would you like to communicate in?
                </p>
                <div class="inputs-wrapper">
                  <input type="radio" id="session_lang_ru" name="language" value="0" checked>
                  <label for="session_lang_ru">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14" data-translate="lang_russian">Russian</span>
                  </label>
                  <div class="divider"></div>
                  <input type="radio" id="session_lang_en" name="language" value="1">
                  <label for="session_lang_en">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14">in English</span>
                  </label>
                  <div class="divider"></div>
                  <input type="radio" id="session_lang_hu" name="language" value="2">
                  <label for="session_lang_hu">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14">magyarul</span>
                  </label>
                </div>
              </div>
              <hr>
              <div class="questions__radio questions__therapy-time">
                <p class="text-20" data-translate="questions_therapy_time">Session time preferences</p>
                <div class="inputs-wrapper">
                  <input type="radio" id="time-any" name="time" value="0" checked>
                  <label for="time-any">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14" data-translate="questions_therapy_time_any">Any</span>
                  </label>
                  <div class="divider"></div>
                  <input type="radio" id="time-soon" name="time" value="1">
                  <label for="time-soon">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14" data-translate="questions_therapy_time_closest">Nearest</span>
                  </label>
                  <div class="divider"></div>
                  <input type="radio" id="time-specific" name="time" value="2">
                  <label for="time-specific">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14" data-translate="questions_therapy_time_specific">Specific</span>
                  </label>
                </div>
                <div class="time-specific-choose">
                  <label for="specific_date_time">
                    <span data-translate="specific_date_time">Select date and time</span>
                    <input type="datetime-local" name="specific_date_time" id="specific_date_time">
                  </label>
                </div>
              </div>
              <hr>
              <div class="questions__radio questions__therapy-price">
                <p class="text-20" data-translate="questions_therapy_price">What price per session would you be
                  comfortable with?</p>
                <div class="inputs-wrapper">
                  <input type="radio" id="price-any" name="price" value="0" checked>
                  <label for="price-any">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14" data-translate="questions_therapy_price_any">Don't care</span>
                  </label>
                  <div class="divider"></div>
                  <input type="radio" id="price-10000" name="price" value="1">
                  <label for="price-10000">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14">10 000 HUF</span>
                  </label>
                  <div class="divider"></div>
                  <input type="radio" id="price-25000" name="price" value="2">
                  <label for="price-25000">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14">25 000 HUF</span>
                  </label>
                  <div class="divider"></div>
                  <input type="radio" id="price-40000" name="price" value="3">
                  <label for="price-40000">
                    <svg width="18" height="18" fill="currentColor">
                      <use xlink:href="./img/sprite.svg#check-mark"></use>
                    </svg>
                    <span class="text-14">40 000 HUF</span>
                  </label>
                </div>
              </div>
              <hr>
              <div class="questions__phone">
                <p class="text-20" data-translate="questions_phone">Please write your telephone number (optional, this
                  is necessary for emergency contact with you if necessary)</p>
                <input type="text" name="user-phone" id="user-phone" placeholder="Your phone number"
                  data-translate="questions_phone_placeholder">
              </div>
              <div class="questions__btn-wrapper">
                <button type="submit" class="questions__btn btn" data-translate="questions_submit_btn">Submit</button>
              </div>
            </form>
          </div>
        </div>
      </section>
    </main>
    <footer class="footer">
      <div class="container">
        <div class="footer__left"></div>
        <div class="footer__copyright">
          <span>&copy; Speak Your Mind 2023</span>
          <a href="terms.html" class="text-green" data-translate="terms">Terms of Service</a>
        </div>
      </div>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const session_token = localStorage.getItem('token');

      // получение данных клиента с бэкенда
      function getUserDataFromBackend() {
        if (session_token) {
          fetch('http://www.speakyourmind.help:8000/get_client_data', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${session_token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ session_token: session_token })
          })
            .then(response => {
              if (!response.ok) {
                throw new Error('Сеть не в порядке');
              }
              return response.json();
            })
            .then(data => {
              // TODO удалить вывод в консоль
              console.log('Данные пользователя:', data);
              updateProfile(data);
            })
            .catch(error => {
              console.error('Ошибка при получении данных пользователя:', error);
            });
        } else {
          console.log('Токен не найден. Пожалуйста, войдите в систему.');
        }
      }

      getUserDataFromBackend();

      function updateProfile(data) {
        // имя
        document.querySelectorAll('.gotten-username').forEach((el) => {
          el.textContent = data.name;
        });

        // дата рождения
        document.querySelector('#age').value = data.user_age;

        // опыт терапии
        const experienceRadioBtns = document.querySelector(`input[name="experience"][value="${data.user_experience}"]`);
        if (experienceRadioBtns) {
          experienceRadioBtns.checked = true;
        }

        // тип терапии
        const typeRadioBtns = document.querySelector(`input[name="type"][value="${data.user_type}"]`);
        if (typeRadioBtns) {
          typeRadioBtns.checked = true;
        }

        // симптомы
        document.querySelectorAll('input[name="symptoms"]').forEach((checkbox) => {
          const value = Number(checkbox.value);
          checkbox.checked = data.user_symptoms.includes(value);
        })

        // пол терапевта
        const genderRadioBtns = document.querySelector(`input[name="therapist-gender"][value="${data.user_therapist_gender}"]`);
        if (genderRadioBtns) {
          genderRadioBtns.checked = true;
        }
        // язык
        const languageRadioBtns = document.querySelector(`input[name="language"][value="${data.user_languages}"]`);
        if (languageRadioBtns) {
          languageRadioBtns.checked = true;
        }
        // время
        const timeRadioBtns = document.querySelector(`input[name="time"][value="${data.user_time}"]`);
        if (timeRadioBtns) {
          timeRadioBtns.checked = true;
        }

        // прайс
        const priceRadioBtns = document.querySelector(`input[name="price"][value="${data.user_price}"]`);
        if (priceRadioBtns) {
          priceRadioBtns.checked = true;
        }
        // конкретное время
        document.querySelector('input[name="specific_date_time"]').value = data.user_specific_date_time;

        // телефон
        document.querySelector('#user-phone').value = data.user_phone;
      };

      // проверка возраста

      const ageInput = document.querySelector('input[name="age"]');
      const submitBtn = document.querySelector('.questions__btn');

      ageInput.addEventListener('change', () => {
        const userBirthDate = new Date(ageInput.value);
        const today = new Date();
        const userAge = today.getFullYear() - userBirthDate.getFullYear();
        const monthDiff = today.getMonth() - userBirthDate.getMonth();

        console.log(ageInput.value);

        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < userBirthDate.getDate())) {
          userAge--;
        }

        if (userAge < 18) {
          submitBtn.disabled = true;
          alert('Вы должны быть старше 18 лет, чтобы отправить эту форму.');
        } else {
          submitBtn.disabled = false;
        }
      });

      // отправка первичной анкеты на бэк
      document.getElementById('user-signup-main-form').addEventListener('submit', function (e) {
        e.preventDefault();

        const user_age = document.getElementById('age').value;
        const user_experience = Number(document.querySelector('input[name="experience"]:checked').value);
        const user_type = Number(document.querySelector('input[name="type"]:checked').value);
        const user_languages = Array.from(document.querySelectorAll('input[name="language"]:checked')).map(checkbox => Number(checkbox.value));
        const user_symptoms = Array.from(document.querySelectorAll('input[name="symptoms"]:checked')).map(checkbox => Number(checkbox.value));
        const user_therapist_gender = Number(document.querySelector('input[name="therapist-gender"]:checked').value);
        const user_time = document.querySelector('input[name="time"]:checked').value;
        const user_specific_date_time = document.querySelector('input[name="specific_date_time"]').value;
        const user_price = Number(document.querySelector('input[name="price"]:checked').value);
        const user_phone = document.getElementById('user-phone').value;

        const dataToSend = {
          session_token: session_token,
          user_age: user_age,
          user_experience: user_experience,
          user_type: user_type,
          user_languages: user_languages,
          user_symptoms: user_symptoms,
          user_therapist_gender: user_therapist_gender,
          user_time: user_time,
          user_specific_date_time: user_specific_date_time,
          user_price: user_price,
          user_phone: user_phone
        };

        if (user_age === '' || user_age === null) {
          localStorage.setItem('user_form', 'empty');
        } else {
          localStorage.setItem('user_form', 'fullfilled');
        }

        fetch('http://www.speakyourmind.help:8000/update_client_data', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(dataToSend)
        })
          .then(response => {
            if (!response.ok) {
              throw new Error('Сеть не в порядке');
            }
            return response.json();
          })
          .then(data => {
            console.log('Данные пользователя обновлены');
            console.log(data);
            window.location.href = '/user-signup-choice.html'
          })
          .catch(error => {
            console.error('Ошибка при получении данных пользователя:', error);
          });
      });
    });
  </script>

  <script src="js/vendor.min.js"></script>
  <script src="js/main.min.js"></script>
</body>

</html>
